<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Schema - CKEditor 5 Documentation</title>
    <meta name="description" content="Learn how to install, integrate and configure CKEditor 5 Builds and how to work with CKEditor 5 Framework, customize it, create your own plugins and custom editors, change the UI or even bring your own UI to the editor. API reference and examples included.">
    <meta name="twitter:card" content="Learn how to install, integrate and configure CKEditor 5 Builds and how to work with CKEditor 5 Framework, customize it, create your own plugins and custom editors, change the UI or even bring your own UI to the editor. API reference and examples included.">
    <meta name="twitter:site" content="@ckeditor">
    <meta property="og:title" content="Schema - CKEditor 5 Documentation">
    <meta property="og:description" content="Learn how to install, integrate and configure CKEditor 5 Builds and how to work with CKEditor 5 Framework, customize it, create your own plugins and custom editors, change the UI or even bring your own UI to the editor. API reference and examples included.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ckeditor.com/docs/ckeditor5/latest/framework/guides/deep-dive/schema.html">
    <meta property="DC.language" content="en">
    <meta property="DC.publisher" content="CKSource">
    <meta property="DC.creator" content="CKEditor">
    <meta property="DC.title" content="Schema - CKEditor 5 Documentation">
    <meta property="DC.format" content="text/html">
    <meta property="DC.type" content="Text">
    <meta property="DC.description" content="Learn how to install, integrate and configure CKEditor 5 Builds and how to work with CKEditor 5 Framework, customize it, create your own plugins and custom editors, change the UI or even bring your own UI to the editor. API reference and examples included.">
    <link rel="canonical" href="https://ckeditor.com/docs/ckeditor5/latest/framework/guides/deep-dive/schema.html">
    <link rel="icon" type="image/png" href="../../../assets/img/favicons/16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="../../../assets/img/favicons/32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../../assets/img/favicons/96x96.png" sizes="96x96">
    <link rel="apple-touch-icon" type="image/png" href="../../../assets/img/favicons/200x200.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
    <link rel="stylesheet" href="../../../../../assets/1.5.2/css/styles.css" type="text/css" media="all">
    <link rel="stylesheet" href="../../../assets/styles.css" type="text/css">
    <script>
      ( function() {
      	'use strict';
      	// Set up global variables;
      	if ( !window.umebrto ) {
      		window.umberto = {};
      	}
      	window.umberto.relativeAppPath = "../../../../../assets/1.5.2/scripts"
      
      	// Add app script
      	var el = document.createElement( 'script' );
      	el.setAttribute( 'async', 'async' );
      	el.setAttribute( 'defer', 'defer' );
      	if ( typeof Symbol === 'function' && typeof Symbol() === 'symbol' ) {
      		el.src = "../../../../../assets/1.5.2/scripts/app.js";
      	} else {
      		el.src = "../../../../../assets/1.5.2/scripts/app-polyfill.js";
      	}
      	document.getElementsByTagName( 'head' )[ 0 ].appendChild( el );
      
      	// Changing documentation theme enable it via `localStorage.setItem( 'theme', 'theme-dark' )`
      	if ( localStorage.getItem( 'theme' ) === 'theme-dark' ) {
      		document.getElementsByTagName( 'html' )[ 0 ].classList.add( 'theme-dark' );
      	}
      } )();
    </script>
    <script>if ( ["ckeditor5.github.io"].indexOf( location.hostname ) !== -1 ) {
      	function pageView() {
      		ga( 'send', 'pageview', location.pathname + location.search + location.hash );
      	}
      
      	(function( i, s, o, g, r, a, m ) {
      		i[ 'GoogleAnalyticsObject' ] = r;
      		i[ r ] = i[ r ] || function() {
      				(i[ r ].q = i[ r ].q || []).push( arguments )
      			}, i[ r ].l = 1 * new Date();
      		a = s.createElement( o ),
      			m = s.getElementsByTagName( o )[ 0 ];
      		a.async = 1;
      		a.src = g;
      		m.parentNode.insertBefore( a, m )
      	})( window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga' );
      
      	ga( 'create', {"trackingId":"UA-271067-19","cookieDomain":"ckeditor5.github.io"} );
      
      	pageView();
      
      	window.addEventListener( 'hashchange', pageView );
      }
    </script>
  <meta name="generator" content="Hexo 4.2.1"></head>
  <body>
    <header class="top" data-project="ckeditor5">
      <div class="header__main">
        <div class="header__main-rwd-button"><a href="#"><span></span><span></span><span></span></a></div>
        <div class="header__main-title"><a class="header__main-title-home" href="../../../../../index.html">CKEditor Ecosystem Documentation</a></div>
        <div class="top__search">
          <input class="top__search__box" type="text" id="docsearch_input" placeholder="Search in CKEditor 5">
          <div class="top__search__button"><img src="../../../../../assets/1.5.2/img/loupe.svg" alt="Search"></div>
        </div>
      </div>
      <div class="header__sub">
        <ul class="top__menu">
          <li class="top__menu-project-logo"><a href="../../../index.html">CKEditor 5</a></li>
          <li><a href="../../../builds/index.html">Builds</a></li>
          <li><a class="top__menu__item--active" href="../../index.html">Framework</a></li>
          <li><a href="../../../examples/index.html">Examples</a></li>
          <li><a href="../../../features/index.html">Features</a></li>
          <li><a class="top__menu__api" href="../../../api/index.html">API</a></li>
          <li><a class="top__menu-github-link" href="https://github.com/ckeditor/ckeditor5" target="_blank" title="CKEditor 5 on GitHub."><svg viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a></li>
        </ul>
      </div>
      <div class="header__menu-rwd">
        <ul class="header__menu-rwd__projects">
          <li data-project="ckeditor5"><a href="../../../../latest/index.html">CKEditor 5</a>
            <ul class="tree header__menu-rwd__projects-pages">
              <li data-group="builds"><a href="../../../builds/index.html">Builds</a>
              </li>
              <li data-group="framework"><a href="../../index.html">Framework</a>
                <ul class="header__menu-rwd__projects-subpages">
                          <li>
                            <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Guides</span></div>
                            <ul class="tree__item-nested-list">
                                  <li><a href="../overview.html">
                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Overview</span></div></a></li>
                                  <li><a href="../quick-start.html">
                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Quick start</span></div></a></li>
                                  <li><a href="../creating-simple-plugin.html">
                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Creating a simple plugin</span></div></a></li>
                                  <li><a href="../development-tools.html">
                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Development tools</span></div></a></li>
                                  <li>
                                    <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Architecture</span></div>
                                    <ul class="tree__item-nested-list">
                                          <li><a href="../architecture/intro.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Introduction</span></div></a></li>
                                          <li><a href="../architecture/core-editor-architecture.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Core editor architecture</span></div></a></li>
                                          <li><a href="../architecture/editing-engine.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Editing engine</span></div></a></li>
                                          <li><a href="../architecture/ui-library.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">UI library</span></div></a></li>
                                    </ul>
                                  </li>
                                  <li>
                                    <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Tutorials</span></div>
                                    <ul class="tree__item-nested-list">
                                          <li><a href="../tutorials/implementing-a-block-widget.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Implementing a block widget</span></div></a></li>
                                          <li><a href="../tutorials/implementing-an-inline-widget.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Implementing an inline widget</span></div></a></li>
                                          <li><a href="../tutorials/using-react-in-a-widget.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Using a React component in a widget</span></div></a></li>
                                    </ul>
                                  </li>
                                  <li>
                                    <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Deep dive</span></div>
                                    <ul class="tree__item-nested-list">
                                          <li><a href="clipboard.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Clipboard</span></div></a></li>
                                          <li><a href="upload-adapter.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Custom upload adapter</span></div></a></li>
                                          <li><a href="observables.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Observables</span></div></a></li>
                                          <li><a href="">
                                              <div class="tree__item__wrapper tree__item__wrapper--active"><span class="tree__item--guide tree__item__text">Schema</span></div></a></li>
                                          <li>
                                            <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Conversion</span></div>
                                            <ul class="tree__item-nested-list">
                                                  <li><a href="conversion/conversion-introduction.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Advanced concepts</span></div></a></li>
                                                  <li><a href="conversion/conversion-extending-output.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Extending editor output</span></div></a></li>
                                                  <li><a href="conversion/conversion-preserving-custom-content.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Preserving custom content</span></div></a></li>
                                            </ul>
                                          </li>
                                          <li>
                                            <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">User interface</span></div>
                                            <ul class="tree__item-nested-list">
                                                  <li><a href="ui/focus-tracking.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Focus tracking</span></div></a></li>
                                                  <li><a href="ui/widget-internals.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Widget internals</span></div></a></li>
                                                  <li><a href="ui/theme-customization.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Theme customization</span></div></a></li>
                                                  <li><a href="ui/external-ui.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Thirdâ€“party UI</span></div></a></li>
                                                  <li><a href="ui/document-editor.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Document editor</span></div></a></li>
                                                  <li><a href="ui/custom-editor-creator.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Creating custom editor</span></div></a></li>
                                                  <li><a href="ui/localization.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Localization</span></div></a></li>
                                            </ul>
                                          </li>
                                    </ul>
                                  </li>
                                  <li>
                                    <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Contributing</span></div>
                                    <ul class="tree__item-nested-list">
                                          <li><a href="../contributing/contributing.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Contributing</span></div></a></li>
                                          <li><a href="../contributing/development-environment.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Development environment</span></div></a></li>
                                          <li><a href="../contributing/testing-environment.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Testing environment</span></div></a></li>
                                          <li><a href="../contributing/code-style.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Code style</span></div></a></li>
                                          <li><a href="../contributing/git-commit-message-convention.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Git commit message convention</span></div></a></li>
                                    </ul>
                                  </li>
                                  <li>
                                    <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Support</span></div>
                                    <ul class="tree__item-nested-list">
                                          <li><a href="../support/browser-compatibility.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Browser compatibility</span></div></a></li>
                                          <li><a href="../support/license-and-legal.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">License and legal</span></div></a></li>
                                          <li><a href="../support/getting-support.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Getting support</span></div></a></li>
                                          <li><a href="../support/reporting-issues.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Reporting issues</span></div></a></li>
                                          <li><a href="../support/versioning-policy.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Versioning policy</span></div></a></li>
                                          <li><a href="../support/error-codes.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Error codes</span></div></a></li>
                                    </ul>
                                  </li>
                            </ul>
                          </li>
                </ul>
              </li>
              <li data-group="examples"><a href="../../../examples/index.html">Examples</a>
              </li>
              <li data-group="features"><a href="../../../features/index.html">Features</a>
              </li>
              <li data-group="api-reference"><a href="../../../api/index.html">API</a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </header>
    <main class="main">
      <section class="main__content formatted">
        <div class="main__content-inner">
          <div class="github-contrib"><a href="https://github.com/ckeditor/ckeditor5/blob/master/packages/ckeditor5-engine/docs/framework/guides/deep-dive/schema.md" target="_blank" rel="noopener" title="Contribute to this guide"><img src="../../../../../assets/1.5.2/img/edit.svg" alt="Contribute to this guide"></a>
          </div>
          <div class="rwd-breadcrumbs"><a href="../../../../../index.html">Home</a><span class="rwd-breadcrumbs__separator">/</span><a href="../../../index.html">CKEditor 5</a><span class="rwd-breadcrumbs__separator">/</span><a href="../../index.html">Framework</a>
          </div>
          <h1 class="main__content-title"><img src="../../../../../assets/1.5.2/img/book.svg" alt="guide">Schema
          </h1><nav class="secondary-navigation"><h3>Table of contents</h3><ol><li><a href="#quick-recap">Quick recap</a></li><li><a href="#defining-allowed-structures">Defining allowed structures</a></li><li><a href="#defining-additional-semantics">Defining additional semantics</a><ol><li><a href="#limit-elements">Limit elements</a></li><li><a href="#object-elements">Object elements</a></li><li><a href="#block-elements">Block elements</a></li><li><a href="#inline-elements">Inline elements</a></li></ol></li><li><a href="#generic-items">Generic items</a></li><li><a href="#defining-advanced-rules-in-checkchild-callbacks">Defining advanced rules in checkChild() callbacks</a></li><li><a href="#implementing-additional-constraints">Implementing additional constraints</a></li><li><a href="#who-checks-the-schema">Who checks the schema?</a><ol><li><a href="#low-level-apis">Low-level APIs</a></li><li><a href="#high-level-apis">High-level APIs</a></li></ol></li></ol></nav>
<p>This article assumes that you have already read the <a href="../architecture/editing-engine.html#schema">&#x201C;Schema&#x201D;</a> section of the <a href="../architecture/editing-engine.html">introduction to the editing engine architecture</a>.</p>
<h2 id="quick-recap"><a class="headerlink" href="#quick-recap">#</a> Quick recap</h2>
<p>The editor&#x2019;s schema is available in the <a href="../../../api/module_engine_model_model-Model.html#member-schema"><code>editor.model.schema</code></a> property. It defines allowed model structures (how model elements can be nested), allowed attributes (of both elements and text nodes), and other characteristics (inline vs. block, atomicity in regards of external actions). This information is later used by editing features and the editing engine to decide how to process the model, where to enable features, etc.</p>
<p>Schema rules can be defined by using the <a href="../../../api/module_engine_model_schema-Schema.html#function-register"><code>Schema#register()</code></a> or <a href="../../../api/module_engine_model_schema-Schema.html#function-extend"><code>Schema#extend()</code></a> methods. The former can be used only once for a given item name which ensures that only a single editing feature can introduce this item. Similarly, <code>extend()</code> can only be used for defined items.</p>
<p>Elements and attributes are checked by features separately by using the <a href="../../../api/module_engine_model_schema-Schema.html#function-checkChild"><code>Schema#checkChild()</code></a> and <a href="../../../api/module_engine_model_schema-Schema.html#function-checkAttribute"><code>Schema#checkAttribute()</code></a> methods.</p>
<h2 id="defining-allowed-structures"><a class="headerlink" href="#defining-allowed-structures">#</a> Defining allowed structures</h2>
<p>When a feature introduces a model element, it should register it in the schema. Besides defining that such an element may exist in the model, the feature also needs to define where this element can be placed:</p>
<pre class="highlight"><code class="js">schema.register( &apos;myElement&apos;, {
    allowIn: &apos;$root&apos;
} );
</code></pre>
<p>This lets the schema know that <code>&lt;myElement&gt;</code> can be a child of <code>&lt;$root&gt;</code>. The <code>$root</code> element is one of the generic nodes defined by the editing framework. By default, the editor names the main root element a <code>&lt;$root&gt;</code>, so the above definition allows <code>&lt;myElement&gt;</code> in the main editor element.</p>
<p>In other words, this would be correct:</p>
<pre class="highlight"><code class="xml">&lt;$root&gt;
    &lt;myElement&gt;&lt;/myElement&gt;
&lt;/$root&gt;
</code></pre>
<p>While this would be incorrect:</p>
<pre class="highlight"><code class="js">&lt;$root&gt;
    &lt;foo&gt;
        &lt;myElement&gt;&lt;/myElement&gt;
    &lt;/foo&gt;
&lt;/$root&gt;
</code></pre>
<h2 id="defining-additional-semantics"><a class="headerlink" href="#defining-additional-semantics">#</a> Defining additional semantics</h2>
<p>In addition to setting allowed structures, the schema can also define additional traits of model elements. By using the <code>is*</code> properties, a feature author may declare how a certain element should be treated by other features and the engine.</p>
<h3 id="limit-elements"><a class="headerlink" href="#limit-elements">#</a> Limit elements</h3>
<p>Consider a feature like an image caption. The caption text area should construct a boundary to some internal actions:</p>
<ul>
<li>A selection that starts inside should not end outside.</li>
<li>Pressing <kbd>Backspace</kbd> or <kbd>Delete</kbd> should not delete the area. Pressing <kbd>Enter</kbd> should not split the area.</li>
</ul>
<p>It should also act as a boundary for external actions. This is mostly enforced by a selection post-fixer that ensures that a selection that starts outside, should not end inside. It means that most actions will either apply to the &#x201C;outside&#x201D; of such an element or to the content inside it.</p>
<p>Taken these characteristics, the image caption should be defined as a limit element by using the <a href="../../../api/module_engine_model_schema-SchemaItemDefinition.html#member-isLimit"><code>isLimit</code></a> property.</p>
<pre class="highlight"><code class="js">schema.register( &apos;myCaption&apos;, {
    isLimit: true
} );
</code></pre>
<p>The engine and various features then check it via <a href="../../../api/module_engine_model_schema-Schema.html#function-isLimit"><code>Schema#isLimit()</code></a> and can act accordingly.</p>
<div class="info-box notice"><p>&#x201C;Limit element&#x201D; does not mean &#x201C;editable element&#x201D;. The concept of &#x201C;editability&#x201D; is reserved for the view and expressed by the <a href="../../../api/module_engine_view_editableelement-EditableElement.html"><code>EditableElement</code> class</a>.</p></div>
<h3 id="object-elements"><a class="headerlink" href="#object-elements">#</a> Object elements</h3>
<p>For an image caption like in the example above it does not make much sense to select the caption box, then copy or drag it somewhere else.</p>
<p>A caption without the image that it describes makes little sense. However, the image is more self-sufficient. Most likely users should be able to select the entire image (with all its internals), then copy or move it around. The <a href="../../../api/module_engine_model_schema-SchemaItemDefinition.html#member-isObject"><code>isObject</code></a> property should be used to mark such behavior.</p>
<pre class="highlight"><code class="js">schema.register( &apos;myImage&apos;, {
    isObject: true
} );
</code></pre>
<p>The <a href="../../../api/module_engine_model_schema-Schema.html#function-isObject"><code>Schema#isObject()</code></a> can later be used to check this property.</p>
<div class="info-box notice"><p>Every &#x201C;object&#x201D; is also a &#x201C;limit&#x201D; element.</p><p>It means that for every element with <code>isObject</code> set to <code>true</code>, <a href="../../../api/module_engine_model_schema-Schema.html#function-isLimit"><code>Schema#isLimit( element )</code></a> will always return <code>true</code>.</p></div>
<h3 id="block-elements"><a class="headerlink" href="#block-elements">#</a> Block elements</h3>
<p>Generally speaking, content is usually made out of blocks like paragraphs, list items, images, headings, etc. All these elements should be marked as blocks by using <a href="../../../api/module_engine_model_schema-SchemaItemDefinition.html#member-isBlock"><code>isBlock</code></a>.</p>
<p>It is important to remember that a block should not allow another block inside. Container elements like <code>&lt;blockQuote&gt;</code>, which can contain other block elements, should not be marked as blocks.</p>
<div class="info-box notice"><p>There is also the <code>$block</code> generic item which has <code>isBlock</code> set to <code>true</code>. Most block type items will inherit from <code>$block</code> (through <code>inheritAllFrom</code>).</p></div>
<h3 id="inline-elements"><a class="headerlink" href="#inline-elements">#</a> Inline elements</h3>
<p>In the editor, all HTML formatting elements such as <code>&lt;strong&gt;</code> or <code>&lt;code&gt;</code> are represented by text attributes. Therefore, inline model elements are not supposed to be used for these scenarios.</p>
<p>Currently, the <a href="../../../api/module_engine_model_schema-SchemaItemDefinition.html#member-isInline"><code>isInline</code></a> property is used for the <code>$text</code> token (so, text nodes) and elements such as <code>&lt;softBreak&gt;</code> or placeholder elements such as in the <a href="../tutorials/implementing-an-inline-widget.html">Implementing an inline widget</a> tutorial.</p>
<p>The support for inline elements in CKEditor 5 is so far limited to self-contained elements. Because of this, all elements marked with <code>isInline</code> should also be marked with <code>isObject</code>.</p>
<h2 id="generic-items"><a class="headerlink" href="#generic-items">#</a> Generic items</h2>
<p>There are three basic generic items: <code>$root</code>, <code>$block</code> and <code>$text</code>. They are defined as follows:</p>
<pre class="highlight"><code class="js">schema.register( &apos;$root&apos;, {
    isLimit: true
} );
schema.register( &apos;$block&apos;, {
    allowIn: &apos;$root&apos;,
    isBlock: true
} );
schema.register( &apos;$text&apos;, {
    allowIn: &apos;$block&apos;,
    isInline: true
} );
</code></pre>
<p>These definitions can then be reused by features to create their own definitions in a more extensible way. For example, the <a href="../../../api/module_paragraph_paragraph-Paragraph.html"><code>Paragraph</code></a> feature will define its item as:</p>
<pre class="highlight"><code class="js">schema.register( &apos;paragraph&apos;, {
    inheritAllFrom: &apos;$block&apos;
} );
</code></pre>
<p>Which translates to:</p>
<pre class="highlight"><code class="js">schema.register( &apos;paragraph&apos;, {
    allowWhere: &apos;$block&apos;,
    allowContentOf: &apos;$block&apos;,
    allowAttributesOf: &apos;$block&apos;,
    inheritTypesFrom: &apos;$block&apos;
} );
</code></pre>
<p>Which can be read as:</p>
<ul>
<li>The <code>&lt;paragraph&gt;</code> element will be allowed in elements in which <code>&lt;$block&gt;</code> is allowed (e.g. in <code>&lt;$root&gt;</code>).</li>
<li>The <code>&lt;paragraph&gt;</code> element will allow all nodes that are allowed in <code>&lt;$block&gt;</code> (e.g. <code>$text</code>).</li>
<li>The <code>&lt;paragraph&gt;</code> element will allow all attributes allowed in <code>&lt;$block&gt;</code>.</li>
<li>The <code>&lt;paragraph&gt;</code> element will inherit all <code>is*</code> properties of <code>&lt;$block&gt;</code> (e.g. <code>isBlock</code>).</li>
</ul>
<p>Thanks to the fact that the <code>&lt;paragraph&gt;</code> definition is inherited from <code>&lt;$block&gt;</code> other features can use the <code>&lt;$block&gt;</code> type to indirectly extend the <code>&lt;paragraph&gt;</code> definition. For example, the <a href="../../../api/module_block-quote_blockquote-BlockQuote.html"><code>BlockQuote</code></a> feature does this:</p>
<pre class="highlight"><code class="js">schema.register( &apos;blockQuote&apos;, {
    allowWhere: &apos;$block&apos;,
    allowContentOf: &apos;$root&apos;
} );
</code></pre>
<p>Thanks to that, despite the fact that block quote and paragraph features know nothing about themselves, paragraphs will be allowed in block quotes and block quotes will be allowed in all places where blocks are allowed. So if anyone registers a <code>&lt;section&gt;</code> element (with the <code>allowContentOf: &apos;$root&apos;</code> rule), that <code>&lt;section&gt;</code> elements will allow block quotes, too.</p>
<p>The side effect of such a definition inheritance is that now <code>&lt;blockQuote&gt;</code> is allowed in <code>&lt;blockQuote&gt;</code> which needs to be resolved by a callback which will disallow this specific structure.</p>
<div class="info-box notice"><p>You can read more about the format of the item definition in <a href="../../../api/module_engine_model_schema-SchemaItemDefinition.html"><code>SchemaItemDefinition</code></a>.</p></div>
<h2 id="defining-advanced-rules-in-checkchild-callbacks"><a class="headerlink" href="#defining-advanced-rules-in-checkchild-callbacks">#</a> Defining advanced rules in <code>checkChild()</code> callbacks</h2>
<p>The <a href="../../../api/module_engine_model_schema-Schema.html#function-checkChild"><code>Schema#checkChild()</code></a> method which is the base method used to check whether some element is allowed in a given structure is <a href="../../../api/module_utils_observablemixin-ObservableMixin.html#function-decorate">a decorated method</a>. It means that you can add listeners to implement your specific rules which are not limited by the <a href="../../../api/module_engine_model_schema-SchemaItemDefinition.html">declarative <code>SchemaItemDefinition</code> API</a>.</p>
<p>These listeners can be added either by listening directly to the <a href="../../../api/module_engine_model_schema-Schema.html#event-checkChild"><code>event:checkChild</code></a> event or by using the handy <a href="../../../api/module_engine_model_schema-Schema.html#function-addChildCheck"><code>Schema#addChildCheck()</code></a> method.</p>
<p>For instance, the block quote feature defines such a listener to disallow nested <code>&lt;blockQuote&gt;</code> structures:</p>
<pre class="highlight"><code class="js">schema.addChildCheck( context, childDefinition ) =&gt; {
    // Note that the context is automatically normalized to a SchemaContext instance and
    // the child to its definition (SchemaCompiledItemDefinition).

    // If checkChild() is called with a context that ends with blockQuote and blockQuote as a child
    // to check, make the checkChild() method return false.
    if ( context.endsWith( &apos;blockQuote&apos; ) &amp;&amp; childDefinition.name == &apos;blockQuote&apos; ) {
        return false;
    }
} );
</code></pre>
<!--
## Defining attributes

TODO
-->
<h2 id="implementing-additional-constraints"><a class="headerlink" href="#implementing-additional-constraints">#</a> Implementing additional constraints</h2>
<p>Schema&#x2019;s capabilities are limited to simple (and atomic) <a href="../../../api/module_engine_model_schema-Schema.html#function-checkChild"><code>Schema#checkChild()</code></a> and <a href="../../../api/module_engine_model_schema-Schema.html#function-checkAttribute"><code>Schema#checkAttribute()</code></a> checks on purpose. One may imagine that the schema should support defining more complex rules such as &quot;element <code>&lt;x&gt;</code> must be always followed by <code>&lt;y&gt;</code>&quot;. While it is feasible to create an API that would enable feeding the schema with such definitions, it is unfortunately unrealistic to then expect that every editing feature will consider these rules when processing the model. It is also unrealistic to expect that it will be done automatically by the schema and the editing engine themselves.</p>
<p>For instance, let&#x2019;s get back to the &quot;element <code>&lt;x&gt;</code> must be always followed by <code>&lt;y&gt;</code>&quot; rule and this initial content:</p>
<pre class="highlight"><code class="xml html">&lt;$root&gt;
    &lt;x&gt;foo&lt;/x&gt;
    &lt;y&gt;bar[bom&lt;/y&gt;
    &lt;z&gt;bom]bar&lt;/z&gt;
&lt;/$root&gt;
</code></pre>
<p>Now imagine that the user presses the &#x201C;Block quote&#x201D; button. Normally it would wrap the two selected blocks (<code>&lt;y&gt;</code> and <code>&lt;z&gt;</code>) with a <code>&lt;blockQuote&gt;</code> element:</p>
<pre class="highlight"><code class="xml html">&lt;$root&gt;
    &lt;x&gt;foo&lt;/x&gt;
    &lt;blockQuote&gt;
        &lt;y&gt;bar[bom&lt;/y&gt;
        &lt;z&gt;bom]bar&lt;/z&gt;
    &lt;/blockQuote&gt;
&lt;/$root&gt;
</code></pre>
<p>But it turns out that this creates an incorrect structure &#x2014; <code>&lt;x&gt;</code> is not followed by <code>&lt;y&gt;</code> anymore.</p>
<p>What should happen instead? There are at least 4 possible solutions: the block quote feature should not be applicable in such a context, someone should create a new <code>&lt;y&gt;</code> right after <code>&lt;x&gt;</code>, <code>&lt;x&gt;</code> should be moved inside <code>&lt;blockQuote&gt;</code> together with <code>&lt;y&gt;</code> or vice versa.</p>
<p>While this is a relatively simple scenario (unlike most real-time collaborative editing scenarios), it turns out that it is already hard to say what should happen and who should react to fix this content.</p>
<p>Therefore, if your editor needs to implement such rules, you should do that through <a href="../../../api/module_engine_model_document-Document.html#function-registerPostFixer">model&#x2019;s post-fixers</a> fixing incorrect content or actively prevent such situations (e.g. by disabling certain features). It means that these constraints will be defined specifically for your scenario by your code which makes their implementation much easier.</p>
<p>To sum up, the answer to who and how should implement additional constraints is: Your features or your editor through the CKEditor 5 API.</p>
<h2 id="who-checks-the-schema"><a class="headerlink" href="#who-checks-the-schema">#</a> Who checks the schema?</h2>
<p>The CKEditor 5 API exposes many ways to work on (change) the model. It can be done <a href="../architecture/editing-engine.html#changing-the-model">through the writer</a>, via methods like <a href="../../../api/module_engine_model_model-Model.html#function-insertContent"><code>Model#insertContent()</code></a>, via commands and so on.</p>
<h3 id="low-level-apis"><a class="headerlink" href="#low-level-apis">#</a> Low-level APIs</h3>
<p>The lowest-level API is the writer (to be precise, there are also raw operations below, but they are used for very special cases only). It allows applying atomic changes to the content like inserting, removing, moving or splitting nodes, setting and removing an attribute, etc. It is important to know that the <strong>writer does not prevent from applying changes that violate rules defined in the schema</strong>.</p>
<p>The reason for this is that when you implement a command or any other feature you may need to perform multiple operations to do all the necessary changes. The state in the meantime (between these atomic operations) may be incorrect. The writer must allow that.</p>
<p>For instance, you need to move <code>&lt;foo&gt;</code> from <code>&lt;$root&gt;</code> to <code>&lt;bar&gt;</code> and (at the same time) rename it to <code>&lt;oof&gt;</code>. But the schema defines that <code>&lt;oof&gt;</code> is not allowed in <code>&lt;$root&gt;</code> and <code>&lt;foo&gt;</code> is disallowed in <code>&lt;bar&gt;</code>. If the writer checked the schema, it would complain regardless of the order of <code>rename</code> and <code>move</code> operations.</p>
<p>You can argue that the engine could handle this by checking the schema at the end of a <a href="../../../api/module_engine_model_model-Model.html#function-change"><code>Model#change()</code> block</a> (it works like a transaction &#x2014; the state needs to be correct at the end of it). In fact, we <a href="https://github.com/ckeditor/ckeditor5-engine/issues/1228" target="_blank" rel="noopener">plan to strip disallowed attributes</a> at the end of these blocks.</p>
<p>There are problems, though:</p>
<ul>
<li>How to fix the content after a transaction is committed? It is impossible to implement a reasonable heuristic that would not break the content from the user perspective.</li>
<li>The model can become invalid during real-time collaborative changes. Operational Transformation, while implemented by us in a very rich form (with 11 types of operations instead of the base 3), ensures conflict resolution and eventual consistency, but not the model&#x2019;s validity.</li>
</ul>
<p>Therefore, we chose to handle such situations on a case-by-case basis, using more expressive and flexible <a href="../../../api/module_engine_model_document-Document.html#function-registerPostFixer">model&#x2019;s post-fixers</a>. Additionally, we moved the responsibility to check the schema to features. They can make a lot better decisions a priori, before doing changes. You can read more about this in the <a href="#implementing-additional-constraints">&#x201C;Implementing additional constraints&#x201D;</a> section above.</p>
<h3 id="high-level-apis"><a class="headerlink" href="#high-level-apis">#</a> High-level APIs</h3>
<p>What about other, higher-level methods? <strong>We recommend that all APIs built on top of the writer should check the schema.</strong></p>
<p>For instance, the <a href="../../../api/module_engine_model_model-Model.html#function-insertContent"><code>Model#insertContent()</code></a> method will make sure that inserted nodes are allowed in the place of their insertion. It may also attempt to split the insertion container (if allowed by the schema) if that will make the element to insert allowed, and so on.</p>
<p>Similarly, commands &#x2014; if implemented correctly &#x2014; <a href="../../../api/module_core_command-Command.html#member-isEnabled">get disabled</a> if they should not be executed in the current place.</p>
<p>Finally, the schema plays a crucial role during the conversion from the view to the model (also called &#x201C;upcasting&#x201D;). During this process converters decide whether they can convert specific view elements or attributes to the given positions in the model. Thanks to that if you tried to load incorrect data to the editor or when you paste content copied from another website, the structure and attributes of the data get adjusted to the current schema rules.</p>
<div class="info-box notice"><p>Some features may miss schema checks. If you happen to find such a scenario, do not hesitate to <a href="https://github.com/ckeditor/ckeditor5/issues" target="_blank" rel="noopener">report it to us</a>.</p></div>

        </div>
      </section>
      <div class="side-navigation">
        <div class="side-navigation__wrapper">
          <nav class="side-navigation__inner">
            <ul class="tree guide-tree">
                          <li>
                            <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Guides</span></div>
                            <ul class="tree__item-nested-list">
                                    <li><a href="../overview.html">
                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Overview</span></div></a></li>
                                    <li><a href="../quick-start.html">
                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Quick start</span></div></a></li>
                                    <li><a href="../creating-simple-plugin.html">
                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Creating a simple plugin</span></div></a></li>
                                    <li><a href="../development-tools.html">
                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Development tools</span></div></a></li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Architecture</span></div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="../architecture/intro.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Introduction</span></div></a></li>
                                              <li><a href="../architecture/core-editor-architecture.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Core editor architecture</span></div></a></li>
                                              <li><a href="../architecture/editing-engine.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Editing engine</span></div></a></li>
                                              <li><a href="../architecture/ui-library.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">UI library</span></div></a></li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Tutorials</span></div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="../tutorials/implementing-a-block-widget.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Implementing a block widget</span></div></a></li>
                                              <li><a href="../tutorials/implementing-an-inline-widget.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Implementing an inline widget</span></div></a></li>
                                              <li><a href="../tutorials/using-react-in-a-widget.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Using a React component in a widget</span></div></a></li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Deep dive</span></div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="clipboard.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Clipboard</span></div></a></li>
                                              <li><a href="upload-adapter.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Custom upload adapter</span></div></a></li>
                                              <li><a href="observables.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Observables</span></div></a></li>
                                              <li><a href="">
                                                  <div class="tree__item__wrapper tree__item__wrapper--active"><span class="tree__item--guide tree__item__text">Schema</span></div></a></li>
                                              <li>
                                                <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Conversion</span></div>
                                                <ul class="tree__item-nested-list">
                                                        <li><a href="conversion/conversion-introduction.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Advanced concepts</span></div></a></li>
                                                        <li><a href="conversion/conversion-extending-output.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Extending editor output</span></div></a></li>
                                                        <li><a href="conversion/conversion-preserving-custom-content.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Preserving custom content</span></div></a></li>
                                                </ul>
                                              </li>
                                              <li>
                                                <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">User interface</span></div>
                                                <ul class="tree__item-nested-list">
                                                        <li><a href="ui/focus-tracking.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Focus tracking</span></div></a></li>
                                                        <li><a href="ui/widget-internals.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Widget internals</span></div></a></li>
                                                        <li><a href="ui/theme-customization.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Theme customization</span></div></a></li>
                                                        <li><a href="ui/external-ui.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Thirdâ€“party UI</span></div></a></li>
                                                        <li><a href="ui/document-editor.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Document editor</span></div></a></li>
                                                        <li><a href="ui/custom-editor-creator.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Creating custom editor</span></div></a></li>
                                                        <li><a href="ui/localization.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Localization</span></div></a></li>
                                                </ul>
                                              </li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Contributing</span></div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="../contributing/contributing.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Contributing</span></div></a></li>
                                              <li><a href="../contributing/development-environment.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Development environment</span></div></a></li>
                                              <li><a href="../contributing/testing-environment.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Testing environment</span></div></a></li>
                                              <li><a href="../contributing/code-style.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Code style</span></div></a></li>
                                              <li><a href="../contributing/git-commit-message-convention.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Git commit message convention</span></div></a></li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Support</span></div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="../support/browser-compatibility.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Browser compatibility</span></div></a></li>
                                              <li><a href="../support/license-and-legal.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">License and legal</span></div></a></li>
                                              <li><a href="../support/getting-support.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Getting support</span></div></a></li>
                                              <li><a href="../support/reporting-issues.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Reporting issues</span></div></a></li>
                                              <li><a href="../support/versioning-policy.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Versioning policy</span></div></a></li>
                                              <li><a href="../support/error-codes.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Error codes</span></div></a></li>
                                      </ul>
                                    </li>
                            </ul>
                          </li>
            </ul>
          </nav>
        </div>
      </div>
    </main>
    <footer class="footer footer--bordered">
      <p>&copy; 2003-2020 <a href="http://cksource.com" target="_blank" rel="noopener">CKSource</a>. All rights reserved.</p>
    </footer>
    <script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
docsearch({
apiKey:'fc463c26455365ad403d5ec51796cd73',indexName:'ckeditor_nightly',inputSelector:'#docsearch_input',algoliaOptions:{hitsPerPage:250,attributesToRetrieve:'*',facetFilters:['tags: ckeditor5']},
transformData: function( hits ) {var sortingFn = function( a, b ) {a.custom_ranking = a.custom_ranking || 0;b.custom_ranking = b.custom_ranking || 0;if ( a.custom_ranking === b.custom_ranking ) return a.index - b.index;if ( a.custom_ranking > b.custom_ranking ) return -1;if ( a.custom_ranking < b.custom_ranking ) return 1;};var result = [];var tags = [ 'builds', 'framework', 'examples', 'features', 'api' ];var hitsGrouped = { api: [] };hitsGrouped[ 'framework' ] = hits.filter( function( h ) {return h.tags.includes( 'framework' );} ).slice( 0, 7 ).map( function( item, idx ) {item.index = idx;return item;} ).sort( sortingFn );tags.forEach( function( tag ) {if ( tag !== 'framework' ) {hitsGrouped[ tag ] = hits.filter( function( h ) {return h.tags.includes( tag );} ).slice( 0, 10 ).map( function( item, idx ) {item.index = idx;return item;} ).sort( sortingFn ).slice( 0, 3 );}} );var apiSearchHits = [];if ( window.apiSearch ) apiSearchHits = window.apiSearch();hitsGrouped.api = hitsGrouped.api.filter( function( h ) {var isDuplicated = false;for ( var i = 0; i < apiSearchHits.length; i++ ) {if ( h.url.includes( apiSearchHits[ i ].urlShort ) ) {isDuplicated = true;break;}}return !isDuplicated;} );hitsGrouped.api = ( apiSearchHits || [] ).concat( hitsGrouped.api );result = result.concat( hitsGrouped[ 'framework' ] );tags.forEach( function( tag ) {if ( tag !== 'framework' ) result = result.concat( hitsGrouped[ tag ].slice( 0, 4 ) );} );return result;}
});
</script>
  </body>
</html>